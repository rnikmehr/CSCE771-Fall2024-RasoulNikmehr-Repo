# Install Tika if not already installed
!pip install tika

# Import necessary libraries
from tika import parser
import os
import glob
from wordcloud import WordCloud, STOPWORDS
import matplotlib.pyplot as plt


%matplotlib inline


# Function to convert PDF to text using Tika
def convertPdf2TxtWithTika(input_pdf, output_txt):
    # Parse the PDF file using Tika
    parsed = parser.from_file(input_pdf)

    # Handle cases where the content is None
    content = parsed['content'] if parsed['content'] is not None else ''

    # Write the extracted content to the output text file, handling encoding errors
    with open(output_txt, 'w', encoding='utf-8', errors='ignore') as f:
        f.write(content)



# Set input and output paths for the 30 resumes
inpath = r'C:\Exercise1-Resume\UnderGrad_Resumes\Input\\'
outpath = r'C:\Exercise1-Resume\UnderGrad_Resumes\Output\\'

# Process all PDF files in the input directory
count = 0
for file in glob.glob(inpath + '*.pdf'):
    justfile = os.path.basename(file).replace(".pdf", "")
    print('INFO: processing file = ' + justfile)
    output_file = os.path.join(outpath, justfile + '.txt')
    print('INFO: - in = ' + file + ', out = ' + output_file)

 # Convert PDF to text
 convertPdf2TxtWithTika(file, output_file)
 count += 1

 print('INFO: processed total files = ' + str(count))



# Combine the content of all text files into one string
pathFilesToUse = outpath

all_content = ''
count = 0
for file in glob.glob(pathFilesToUse + '*.txt'):
    print("file = " + file)
    with open(file, 'r', encoding='utf-8', errors='ignore') as file_handle:
        content = str(file_handle.read()).split()
        content_as_str = " ".join(content)
        all_content += content_as_str
        count += 1

        print('INFO: processed total files = ' + str(count))



# Function to draw word cloud
def wordcloud_draw(data, color='black'):
    words = ' '.join(data)
    cleaned_word = " ".join([word for word in words.split()
        if 'http' not in word
        and not word.startswith('@')
        and not word.startswith('#')
        and word != 'RT'
        ])
    wordcloud = WordCloud(stopwords=STOPWORDS,
        background_color=color,
        width=2500,
        height=2000
        ).generate(cleaned_word)
    plt.figure(1, figsize=(13, 13))
    plt.imshow(wordcloud, interpolation="bilinear")
    plt.axis('off')
    plt.show()



    # Draw the word cloud from all content
    wordcloud_draw(all_content.split())
